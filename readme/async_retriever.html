
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

<meta property="og:title" content="AsyncRetriever: Asynchronous requests with persistent caching" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://hyriver.readthedocs.io/en/readme/async_retriever.html" />
  
<meta property="og:description" content="PyPi Conda Version CodeCov Python Versions Github Actions, Security Status CodeFactor black pre-commit, Features: AsyncRetriever is a part of HyRiver software stack that is designed to aid in hydro..." />
  
<meta property="og:image" content="https://raw.githubusercontent.com/cheginit/HyRiver/main/docs/source/_static/hydriver_logo.png" />
  
<meta property="og:image:alt" content="AsyncRetriever: Asynchronous requests with persistent caching" />
  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@_taher_" />
<meta name="twitter:creator" content="@_taher_" />
<meta name="twitter:description" content="HyRiver is a suite of Python packages that provides a unified API for retrieving geospatial/temporal data from various web services." />
<meta name="twitter:image" content="https://raw.githubusercontent.com/cheginit/HyRiver/main/docs/source/_static/hydriver_logo.png" />
<meta name="twitter:image:alt" content="HyRiver is a suite of Python packages that provides a unified API for retrieving geospatial/temporal data from various web services." />
    <title>AsyncRetriever: Asynchronous requests with persistent caching</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyGeoOGC: Retrieve Data from RESTful, WMS, and WFS Services" href="pygeoogc.html" />
    <link rel="prev" title="PyDaymet: Daily climate data through Daymet" href="pydaymet.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/hyriver_logo_text.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Hydroclimate Data Retriever
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../readmes.html">
   Software Stack
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="pynhd.html">
     PyNHD: Navigate and subset NHDPlus database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pygeohydro.html">
     PyGeoHydro: Retrieve Geospatial Hydrology Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="py3dep.html">
     Py3DEP: Topographic data through 3DEP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pydaymet.html">
     PyDaymet: Daily climate data through Daymet
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     AsyncRetriever: Asynchronous requests with persistent caching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pygeoogc.html">
     PyGeoOGC: Retrieve Data from RESTful, WMS, and WFS Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pygeoutils.html">
     PyGeoUtils: Utilities for (Geo)JSON and (Geo)TIFF Conversion
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../examples.html">
   Example Gallery
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/3dep.html">
     Topographic Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/aridity.html">
     Aridity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/columbia.html">
     Dams in Columbia River Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/cross_section.html">
     River Elevation and Cross-Section
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/dam_impact.html">
     Working with Geospatial Hydrologic Data Using Web Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/daymet.html">
     Climate Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/geoconnex.html">
     GeoConnex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/hymod_calibration.html">
     Hydrological Modeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ndvi.html">
     NDVI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nhdplus.html">
     River Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nid.html">
     National Inventory of Dams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nid_dib.html">
     Spatiotemporal Distribution of Dams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nlcd.html">
     Land Use/Land Cover
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/noaa.html">
     Water Levels and Tides
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nwis.html">
     River Discharge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/pet_validation.html">
     Computing PET
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/pygeoapi.html">
     Split Catchment with PyGeoAPI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/rem.html">
     Relative Elevation Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ssebop.html">
     Actual Evapotranspiration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/us_coasts.html">
     CONUS Coasts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/water_quality.html">
     Water Quality Portal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/webservices.html">
     Web Services Queries
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../autoapi/index.html">
   API References
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pynhd/index.html">
     PyNHD
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/core/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.core
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/network_tools/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.network_tools
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/nhdplus_derived/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.nhdplus_derived
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/pynhd/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.pynhd
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pygeohydro/index.html">
     PyGeoHydro
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/helpers/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.helpers
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/plot/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.plot
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/pygeohydro/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.pygeohydro
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/us_abbrs/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.us_abbrs
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/waterdata/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.waterdata
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/py3dep/index.html">
     Py3DEP
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/py3dep/py3dep/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         py3dep.py3dep
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/py3dep/utils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         py3dep.utils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pydaymet/index.html">
     PyDaymet
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pydaymet/core/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pydaymet.core
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pydaymet/pet/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pydaymet.pet
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pydaymet/pydaymet/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pydaymet.pydaymet
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/async_retriever/index.html">
     AsyncRetriever
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/async_retriever/async_retriever/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         async_retriever.async_retriever
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/async_retriever/utils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         async_retriever.utils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pygeoogc/index.html">
     PyGeoOGC
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoogc/core/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoogc.core
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoogc/pygeoogc/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoogc.pygeoogc
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoogc/utils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoogc.utils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pygeoutils/index.html">
     PyGeoUtils
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoutils/pygeoutils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoutils.pygeoutils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../history.html">
   Changelogs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pynhd.html">
     PyNHD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pygeohydro.html">
     PyGeoHydro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/py3dep.html">
     Py3DEP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pydaymet.html">
     PyDaymet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/async_retriever.html">
     AsyncRetriever
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pygeoogc.html">
     PyGeoOGC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pygeoutils.html">
     PyGeoUtils
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributing.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../authors.html">
   Credits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../license.html">
   License
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/cheginit/HyRiver"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/cheginit/HyRiver/issues/new?title=Issue%20on%20page%20%2Freadme/async_retriever.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/cheginit/HyRiver/edit/main/docs/readme/async_retriever.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   AsyncRetriever: Asynchronous requests with persistent caching
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   Features
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>AsyncRetriever: Asynchronous requests with persistent caching</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   AsyncRetriever: Asynchronous requests with persistent caching
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   Features
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="asyncretriever-asynchronous-requests-with-persistent-caching">
<h1>AsyncRetriever: Asynchronous requests with persistent caching<a class="headerlink" href="#asyncretriever-asynchronous-requests-with-persistent-caching" title="Permalink to this headline">#</a></h1>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/async_retriever"><img alt="PyPi" src="https://img.shields.io/pypi/v/async_retriever.svg" /></a>
<a class="reference external image-reference" href="https://anaconda.org/conda-forge/async_retriever"><img alt="Conda Version" src="https://img.shields.io/conda/vn/conda-forge/async_retriever.svg" /></a>
<a class="reference external image-reference" href="https://codecov.io/gh/hyriver/async_retriever"><img alt="CodeCov" src="https://codecov.io/gh/hyriver/async_retriever/branch/main/graph/badge.svg" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/async_retriever"><img alt="Python Versions" src="https://img.shields.io/pypi/pyversions/async_retriever.svg" /></a>
<a class="reference external image-reference" href="https://github.com/hyriver/async_retriever/actions/workflows/test.yml"><img alt="Github Actions" src="https://github.com/hyriver/async_retriever/actions/workflows/test.yml/badge.svg" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference external image-reference" href="https://github.com/PyCQA/bandit"><img alt="Security Status" src="https://img.shields.io/badge/security-bandit-green.svg" /></a>
<a class="reference external image-reference" href="https://www.codefactor.io/repository/github/hyriver/async_retriever"><img alt="CodeFactor" src="https://www.codefactor.io/repository/github/hyriver/async_retriever/badge" /></a>
<a class="reference external image-reference" href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg" /></a>
<a class="reference external image-reference" href="https://github.com/pre-commit/pre-commit"><img alt="pre-commit" src="https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&amp;logoColor=white" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="features">
<h1>Features<a class="headerlink" href="#features" title="Permalink to this headline">#</a></h1>
<p>AsyncRetriever is a part of <a class="reference external" href="https://github.com/hyriver/HyRiver">HyRiver</a> software stack that
is designed to aid in hydroclimate analysis through web services. This package serves as HyRiver’s
engine for asynchronously sending requests and retrieving responses as <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">binary</span></code>, or
<code class="docutils literal notranslate"><span class="pre">json</span></code> objects. It uses persistent caching using
<a class="reference external" href="https://aiohttp-client-cache.readthedocs.io">aiohttp-client-cache</a> to speed up the retrieval
even further. Moreover, thanks to <a class="reference external" href="https://github.com/erdewit/nest_asyncio">nest_asyncio</a>
you can use this package in Jupyter notebooks. Although this package is part of the HyRiver
software stack, it can be used for any web calls. There are three functions that you can
use to make web calls:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">retrieve_text</span></code>: Get responses as <code class="docutils literal notranslate"><span class="pre">text</span></code> objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">retrieve_binary</span></code>: Get responses as <code class="docutils literal notranslate"><span class="pre">binary</span></code> objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">retrieve_json</span></code>: Get responses as <code class="docutils literal notranslate"><span class="pre">json</span></code> objects.</p></li>
</ul>
<p>You can also use the general-purpose <code class="docutils literal notranslate"><span class="pre">retrieve</span></code> function to get responses as any
of the three types. All responses are returned as a list that has the same order as the
input list of requests. Moreover, there is another function called <code class="docutils literal notranslate"><span class="pre">delete_url_cache</span></code>
for removing all requests from a cache file that contains the given URL.</p>
<p>You can control the request/response caching behavior by setting the following
environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HYRIVER_CACHE_NAME</span></code>: Path to the caching SQLite database. It defaults to
<code class="docutils literal notranslate"><span class="pre">./cache/aiohttp_cache.sqlite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HYRIVER_CACHE_EXPIRE</span></code>: Expiration time for cached requests in seconds. It defaults to
-1 (never expire).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HYRIVER_CACHE_DISABLE</span></code>: Disable reading/writing from/to the cache. The default is false.</p></li>
</ul>
<p>For example, in your code before making any requests you can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HYRIVER_CACHE_NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;path/to/file.sqlite&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HYRIVER_CACHE_EXPIRE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3600&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HYRIVER_CACHE_DISABLE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
<p>You can find some example notebooks <a class="reference external" href="https://github.com/hyriver/HyRiver-examples">here</a>.</p>
<p>You can also try using AsyncRetriever without installing
it on your system by clicking on the binder badge. A Jupyter Lab
instance with the HyRiver stack pre-installed will be launched in your web browser, and you
can start coding!</p>
<p>Please note that since this project is in the early development stages, while the provided
functionalities should be stable, changes in APIs are possible in new releases. But we
appreciate it if you give this project a try and provide feedback. Contributions are most welcome.</p>
<p>Moreover, requests for additional functionalities can be submitted via
<a class="reference external" href="https://github.com/hyriver/async_retriever/issues">issue tracker</a>.</p>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h1>
<p>You can install <code class="docutils literal notranslate"><span class="pre">async_retriever</span></code> using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install async_retriever
</pre></div>
</div>
<p>Alternatively, <code class="docutils literal notranslate"><span class="pre">async_retriever</span></code> can be installed from the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> repository
using <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda install -c conda-forge async_retriever
</pre></div>
</div>
</section>
<section id="quick-start">
<h1>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this headline">#</a></h1>
<p>AsyncRetriever by default creates and/or uses <code class="docutils literal notranslate"><span class="pre">./cache/aiohttp_cache.sqlite</span></code> as the cache
that you can customize by the <code class="docutils literal notranslate"><span class="pre">cache_name</span></code> argument. Also, by default, the cache doesn’t
have any expiration date and the <code class="docutils literal notranslate"><span class="pre">delete_url_cache</span></code> function should be used if you know
that a database on a server was updated, and you want to retrieve the latest data.
Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">expire_after</span></code> to set the expiration date for the cache.</p>
<p>As an example for retrieving a <code class="docutils literal notranslate"><span class="pre">binary</span></code> response, let’s use the DAAC server to get
<a class="reference external" href="https://daac.ornl.gov/VEGETATION/guides/US_MODIS_NDVI.html">NDVI</a>.
The responses can be directly passed to <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset</span></code> to get the data as
a <code class="docutils literal notranslate"><span class="pre">xarray</span></code> Dataset. We can also disable SSL certificate verification by setting
<code class="docutils literal notranslate"><span class="pre">ssl=False</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">async_retriever</span> <span class="k">as</span> <span class="nn">ar</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">north</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">69.77</span><span class="p">,</span> <span class="mf">45.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">69.31</span><span class="p">,</span> <span class="mf">45.45</span><span class="p">)</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://thredds.daac.ornl.gov/thredds/ncss/ornldaac/1299&quot;</span>
<span class="n">dates_itr</span> <span class="o">=</span> <span class="p">((</span><span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2005</span><span class="p">))</span>
<span class="n">urls</span><span class="p">,</span> <span class="n">kwds</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="o">*</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/MCD13.A</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">.unaccum.nc4&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="s2">&quot;NDVI&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">north</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;west&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">west</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">east</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;south&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">south</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;disableProjSubset&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;horizStride&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;time_start&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;time_end&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;timeStride&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;addLatLon&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dates_itr</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">retrieve_binary</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">kwds</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">)</span>
</pre></div>
</div>
<p>We can remove these requests and their responses from the cache like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ar</span><span class="o">.</span><span class="n">delete_url_cache</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/async.ipunb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/ndvi.png" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/ndvi.png" /></a>
<p>For a <code class="docutils literal notranslate"><span class="pre">json</span></code> response example, let’s get water level recordings of an NOAA’s water level station,
8534720 (Atlantic City, NJ), during 2012, using CO-OPS API. Note that this CO-OPS product has a
31-day limit for a single request, so we have to break the request down accordingly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">station_id</span> <span class="o">=</span> <span class="s2">&quot;8534720&quot;</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2012-01-01&quot;</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2012-12-31&quot;</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">start</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">):</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">e</span><span class="o">.</span><span class="n">date</span><span class="p">()))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">()</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.tidesandcurrents.noaa.gov/api/prod/datagetter&quot;</span>

<span class="n">urls</span><span class="p">,</span> <span class="n">kwds</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="o">*</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;water_level&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;application&quot;</span><span class="p">:</span> <span class="s2">&quot;web_services&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;begin_date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;datum&quot;</span><span class="p">:</span> <span class="s2">&quot;MSL&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;time_zone&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">dates</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">retrieve_json</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="n">wl_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rjson</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">rjson</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
    <span class="n">wl</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">wl</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">wl</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
    <span class="n">wl</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">wl</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>
    <span class="n">wl_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span>
<span class="n">water_level</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">wl_list</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">water_level</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">rjson</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/async.ipunb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/water_level.png" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/water_level.png" /></a>
<p>Now, let’s see an example without any payload or headers. Here’s how we can retrieve
harmonic constituents of several NOAA stations from CO-OPS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;8410140&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8411060&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8413320&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8418150&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8419317&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8419870&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8443970&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8447386&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.tidesandcurrents.noaa.gov/mdapi/prod/webapi/stations&quot;</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/harcon.json?units=metric&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">]</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="n">retrieve_json</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

<span class="n">amp_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">phs_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rjson</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
    <span class="n">sid</span> <span class="o">=</span> <span class="n">rjson</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">const</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">rjson</span><span class="p">[</span><span class="s2">&quot;HarmonicConstituents&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;amplitude&quot;</span><span class="p">:</span> <span class="n">sid</span><span class="p">})[</span><span class="n">sid</span><span class="p">]</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;phase_GMT&quot;</span><span class="p">:</span> <span class="n">sid</span><span class="p">})[</span><span class="n">sid</span><span class="p">]</span>
    <span class="n">amp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
    <span class="n">phs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>

<span class="n">amp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">amp_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">phs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">phs_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/async.ipunb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/tides.png" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/tides.png" /></a>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="pydaymet.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">PyDaymet: Daily climate data through Daymet</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pygeoogc.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PyGeoOGC: Retrieve Data from RESTful, WMS, and WFS Services</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Taher Chegini<br/>
  
      &copy; Copyright 2019-2022, Taher Chegini.<br/>
    Last updated on 2022-07-26.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>