
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

<meta property="og:title" content="PyNHD: Navigate and subset NHDPlus database" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://hyriver.readthedocs.io/en/readme/pynhd.html" />
  
<meta property="og:description" content="PyPi Conda Version CodeCov Python Versions Downloads, CodeFactor black pre-commit Binder, Features: PyNHD is a part of HyRiver software stack that is designed to aid in hydroclimate analysis throug..." />
  
<meta property="og:image" content="https://raw.githubusercontent.com/cheginit/HyRiver/main/docs/source/_static/hydriver_logo.png" />
  
<meta property="og:image:alt" content="PyNHD: Navigate and subset NHDPlus database" />
  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@_taher_" />
<meta name="twitter:creator" content="@_taher_" />
<meta name="twitter:description" content="HyRiver is a suite of Python packages that provides a unified API for retrieving geospatial/temporal data from various web services." />
<meta name="twitter:image" content="https://raw.githubusercontent.com/cheginit/HyRiver/main/docs/source/_static/hydriver_logo.png" />
<meta name="twitter:image:alt" content="HyRiver is a suite of Python packages that provides a unified API for retrieving geospatial/temporal data from various web services." />
    <title>PyNHD: Navigate and subset NHDPlus database</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyGeoHydro: Retrieve Geospatial Hydrology Data" href="pygeohydro.html" />
    <link rel="prev" title="Software Stack" href="../readmes.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/hyriver_logo_text.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Hydroclimate Data Retriever
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../readmes.html">
   Software Stack
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     PyNHD: Navigate and subset NHDPlus database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pygeohydro.html">
     PyGeoHydro: Retrieve Geospatial Hydrology Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="py3dep.html">
     Py3DEP: Topographic data through 3DEP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pydaymet.html">
     PyDaymet: Daily climate data through Daymet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="async_retriever.html">
     AsyncRetriever: Asynchronous requests with persistent caching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pygeoogc.html">
     PyGeoOGC: Retrieve Data from RESTful, WMS, and WFS Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pygeoutils.html">
     PyGeoUtils: Utilities for (Geo)JSON and (Geo)TIFF Conversion
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../examples.html">
   Example Gallery
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/3dep.html">
     Topographic Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/aridity.html">
     Aridity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/columbia.html">
     Dams in Columbia River Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/cross_section.html">
     River Elevation and Cross-Section
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/dam_impact.html">
     Working with Geospatial Hydrologic Data Using Web Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/daymet.html">
     Climate Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/geoconnex.html">
     GeoConnex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/hymod_calibration.html">
     Hydrological Modeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ndvi.html">
     NDVI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nhdplus.html">
     River Network
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nid.html">
     National Inventory of Dams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nid_dib.html">
     Spatiotemporal Distribution of Dams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nlcd.html">
     Land Use/Land Cover
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/noaa.html">
     Water Levels and Tides
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/nwis.html">
     River Discharge
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/pet_validation.html">
     Computing PET
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/pygeoapi.html">
     Split Catchment with PyGeoAPI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/rem.html">
     Relative Elevation Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ssebop.html">
     Actual Evapotranspiration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/us_coasts.html">
     CONUS Coasts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/water_quality.html">
     Water Quality Portal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/webservices.html">
     Web Services Queries
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../autoapi/index.html">
   API References
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pynhd/index.html">
     PyNHD
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/core/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.core
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/network_tools/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.network_tools
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/nhdplus_derived/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.nhdplus_derived
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pynhd/pynhd/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pynhd.pynhd
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pygeohydro/index.html">
     PyGeoHydro
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/helpers/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.helpers
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/plot/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.plot
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/pygeohydro/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.pygeohydro
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/us_abbrs/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.us_abbrs
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeohydro/waterdata/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeohydro.waterdata
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/py3dep/index.html">
     Py3DEP
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/py3dep/py3dep/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         py3dep.py3dep
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/py3dep/utils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         py3dep.utils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pydaymet/index.html">
     PyDaymet
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pydaymet/core/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pydaymet.core
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pydaymet/pet/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pydaymet.pet
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pydaymet/pydaymet/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pydaymet.pydaymet
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/async_retriever/index.html">
     AsyncRetriever
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/async_retriever/async_retriever/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         async_retriever.async_retriever
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/async_retriever/utils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         async_retriever.utils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pygeoogc/index.html">
     PyGeoOGC
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoogc/core/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoogc.core
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoogc/pygeoogc/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoogc.pygeoogc
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoogc/utils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoogc.utils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../autoapi/pygeoutils/index.html">
     PyGeoUtils
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../autoapi/pygeoutils/pygeoutils/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         pygeoutils.pygeoutils
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../history.html">
   Changelogs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pynhd.html">
     PyNHD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pygeohydro.html">
     PyGeoHydro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/py3dep.html">
     Py3DEP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pydaymet.html">
     PyDaymet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/async_retriever.html">
     AsyncRetriever
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pygeoogc.html">
     PyGeoOGC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../changelogs/pygeoutils.html">
     PyGeoUtils
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributing.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../authors.html">
   Credits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../license.html">
   License
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/cheginit/HyRiver"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/cheginit/HyRiver/issues/new?title=Issue%20on%20page%20%2Freadme/pynhd.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/cheginit/HyRiver/edit/main/docs/readme/pynhd.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   PyNHD: Navigate and subset NHDPlus database
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   Features
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>PyNHD: Navigate and subset NHDPlus database</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   PyNHD: Navigate and subset NHDPlus database
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#features">
   Features
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation">
   Installation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quick-start">
   Quick start
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="pynhd-navigate-and-subset-nhdplus-database">
<h1>PyNHD: Navigate and subset NHDPlus database<a class="headerlink" href="#pynhd-navigate-and-subset-nhdplus-database" title="Permalink to this headline">#</a></h1>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/pynhd"><img alt="PyPi" src="https://img.shields.io/pypi/v/pynhd.svg" /></a>
<a class="reference external image-reference" href="https://anaconda.org/conda-forge/pynhd"><img alt="Conda Version" src="https://img.shields.io/conda/vn/conda-forge/pynhd.svg" /></a>
<a class="reference external image-reference" href="https://codecov.io/gh/hyriver/pynhd"><img alt="CodeCov" src="https://codecov.io/gh/hyriver/pynhd/branch/main/graph/badge.svg" /></a>
<a class="reference external image-reference" href="https://pypi.python.org/pypi/pynhd"><img alt="Python Versions" src="https://img.shields.io/pypi/pyversions/pynhd.svg" /></a>
<a class="reference external image-reference" href="https://pepy.tech/project/pynhd"><img alt="Downloads" src="https://pepy.tech/badge/pynhd" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<a class="reference external image-reference" href="https://www.codefactor.io/repository/github/hyriver/pynhd"><img alt="CodeFactor" src="https://www.codefactor.io/repository/github/hyriver/pynhd/badge" /></a>
<a class="reference external image-reference" href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg" /></a>
<a class="reference external image-reference" href="https://github.com/pre-commit/pre-commit"><img alt="pre-commit" src="https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&amp;logoColor=white" /></a>
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/hyriver/HyRiver-examples/main?urlpath=lab/tree/notebooks"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="features">
<h1>Features<a class="headerlink" href="#features" title="Permalink to this headline">#</a></h1>
<p>PyNHD is a part of <a class="reference external" href="https://github.com/hyriver/HyRiver">HyRiver</a> software stack that
is designed to aid in hydroclimate analysis through web services.</p>
<p>This package provides access to several hydro-linked datasets including
<a class="reference external" href="https://labs.waterdata.usgs.gov/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage?1">WaterData</a>,
The National Map’s <a class="reference external" href="https://hydro.nationalmap.gov/arcgis/rest/services/nhd/MapServer">NHDPlus MR</a>,
and <a class="reference external" href="https://hydro.nationalmap.gov/arcgis/rest/services/NHDPlus_HR/MapServer">NHDPlus HR</a>,
<a class="reference external" href="https://labs.waterdata.usgs.gov/about-nldi/">NLDI</a>,
<a class="reference external" href="https://labs.waterdata.usgs.gov/api/nldi/pygeoapi">PyGeoAPI</a>,
and <a class="reference external" href="https://geoconnex.internetofwater.dev/">GeoConnex</a>.</p>
<p>These web services can be used to navigate and extract vector data from NHDPlus V2 (both mid-
and high-resolution) database such as catchments, HUC8, HUC12, GagesII, flowlines, and water
bodies. Moreover, PyNHD gives access to an item on <a class="reference external" href="https://sciencebase.usgs.gov">ScienceBase</a>
called Select Attributes for NHDPlus Version 2.1 Reach Catchments and Modified Network Routed
Upstream Watersheds for the Conterminous United States that is located
<a class="reference external" href="https://www.sciencebase.gov/catalog/item/5669a79ee4b08895842a1d47">here</a>.
This item provides over 30 attributes at catchment-scale based on NHDPlus ComIDs.
These attributes are available in three categories:</p>
<ol class="arabic simple">
<li><p>Local (<cite>local</cite>): For individual reach catchments,</p></li>
<li><p>Total (<cite>upstream_acc</cite>): For network-accumulated values using total cumulative drainage area,</p></li>
<li><p>Divergence (<cite>div_routing</cite>): For network-accumulated values using divergence-routed.</p></li>
</ol>
<p>A list of these attributes for each characteristic type can be accessed using <code class="docutils literal notranslate"><span class="pre">nhdplus_attrs</span></code>
function.</p>
<p>Moreover, the PyGeoAPI service provides four functionalities:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flow_trace</span></code>: Trace flow from a starting point to up/downstream direction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split_catchment</span></code>: Split the local catchment of a point of interest at the point’s location.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">elevation_profile</span></code>: Extract elevation profile along a flow path between two points.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cross_section</span></code>: Extract cross-section at a point of interest along a flow line.</p></li>
</ol>
<p>Similarly, PyNHD provides access to ComID-linked NHDPlus Value Added Attributes on
<a class="reference external" href="https://www.hydroshare.org/resource/6092c8a62fac45be97a09bfd0b0bf726/">Hydroshare</a>.
This dataset includes slope and roughness, among other attributes, for all the flowlines.
You can use <code class="docutils literal notranslate"><span class="pre">nhdplus_vaa</span></code> function to get this dataset.</p>
<p>Additionally, PyNHD offers some extra utilities for processing the flowlines:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flowline_xsection</span></code> and <code class="docutils literal notranslate"><span class="pre">network_xsection</span></code>: Get cross-section lines along a flowline
at a given spacing or a network of flowlines at a given spacing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flowline_resample</span></code> and <code class="docutils literal notranslate"><span class="pre">network_resample</span></code>:
Resampe a flowline or network of flowlines based on a given spacing. This is
useful for smoothing jagged flowlines similar to those in the NHDPlus database.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prepare_nhdplus</span></code>: For cleaning up the data frame by, for example, removing tiny networks,
adding a <code class="docutils literal notranslate"><span class="pre">to_comid</span></code> column, and finding terminal flowlines if it doesn’t exist.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topoogical_sort</span></code>: For sorting the river network topologically which is useful for routing
and flow accumulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vector_accumulation</span></code>: For computing flow accumulation in a river network. This function
is generic, and any routing method can be plugged in.</p></li>
</ul>
<p>These utilities are developed based on an R package called
<a class="reference external" href="https://github.com/USGS-R/nhdplusTools">nhdplusTools</a> and a Python package
called <a class="reference external" href="https://code.usgs.gov/wma/nhgf/toolsteam/nldi-xstool">nldi-xstool</a>.</p>
<p>All functions and classes that request data from web services use <code class="docutils literal notranslate"><span class="pre">async_retriever</span></code>
that offers response caching. By default, the expiration time is set to never expire.
All these functions and classes have two optional parameters for controlling the cache:
<code class="docutils literal notranslate"><span class="pre">expire_after</span></code> and <code class="docutils literal notranslate"><span class="pre">disable_caching</span></code>. You can use <code class="docutils literal notranslate"><span class="pre">expire_after</span></code> to set the expiration
time in seconds. If <code class="docutils literal notranslate"><span class="pre">expire_after</span></code> is set to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, the cache will never expire (default).
You can use <code class="docutils literal notranslate"><span class="pre">disable_caching</span></code> if you don’t want to use the cached responses. The cached
responses are stored in the <code class="docutils literal notranslate"><span class="pre">./cache/aiohttp_cache.sqlite</span></code> file.</p>
<p>You can find some example notebooks <a class="reference external" href="https://github.com/hyriver/HyRiver-examples">here</a>.</p>
<p>Moreover, under the hood, PyNHD uses
<a class="reference external" href="https://github.com/hyriver/async_retriever">AsyncRetriever</a>
for making requests asynchronously with persistent caching. This improves the
reliability and speed of data retrieval significantly. AsyncRetriever caches all request/response
pairs and upon making an already cached request, it will retrieve the responses from the cache
if the server’s response is unchanged.</p>
<p>You can control the request/response caching behavior by setting the following
environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HYRIVER_CACHE_NAME</span></code>: Path to the caching SQLite database. It defaults to
<code class="docutils literal notranslate"><span class="pre">./cache/aiohttp_cache.sqlite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HYRIVER_CACHE_EXPIRE</span></code>: Expiration time for cached requests in seconds. It defaults to
-1 (never expire).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HYRIVER_CACHE_DISABLE</span></code>: Disable reading/writing from/to the cache. The default is false.</p></li>
</ul>
<p>For example, in your code before making any requests you can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HYRIVER_CACHE_NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;path/to/file.sqlite&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HYRIVER_CACHE_EXPIRE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3600&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HYRIVER_CACHE_DISABLE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
<p>You can also try using PyNHD without installing
it on your system by clicking on the binder badge. A Jupyter Lab
instance with the HyRiver stack pre-installed will be launched in your web browser, and you
can start coding!</p>
<p>Please note that since this project is in the early development stages, while the provided
functionalities should be stable, changes in APIs are possible in new releases. But we
appreciate it if you give this project a try and provide feedback. Contributions are most welcome.</p>
<p>Moreover, requests for additional functionalities can be submitted via
<a class="reference external" href="https://github.com/hyriver/pynhd/issues">issue tracker</a>.</p>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h1>
<p>You can install PyNHD using <code class="docutils literal notranslate"><span class="pre">pip</span></code> after installing <code class="docutils literal notranslate"><span class="pre">libgdal</span></code> on your system
(for example, in Ubuntu run <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">libgdal-dev</span></code>):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install pynhd
</pre></div>
</div>
<p>Alternatively, PyNHD can be installed from the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> repository
using <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a>
or <a class="reference external" href="https://github.com/conda-forge/miniforge">Mamba</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda install -c conda-forge pynhd
</pre></div>
</div>
</section>
<section id="quick-start">
<h1>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this headline">#</a></h1>
<p>Let’s explore the capabilities of <code class="docutils literal notranslate"><span class="pre">NLDI</span></code>. We need to instantiate the class first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pynhd</span> <span class="kn">import</span> <span class="n">NLDI</span><span class="p">,</span> <span class="n">WaterData</span><span class="p">,</span> <span class="n">NHDPlusHR</span>
<span class="kn">import</span> <span class="nn">pynhd</span> <span class="k">as</span> <span class="nn">nhd</span>
</pre></div>
</div>
<p>First, let’s get the watershed geometry of the contributing basin of a
USGS station using <code class="docutils literal notranslate"><span class="pre">NLDI</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nldi</span> <span class="o">=</span> <span class="n">NLDI</span><span class="p">()</span>
<span class="n">station_id</span> <span class="o">=</span> <span class="s2">&quot;01031500&quot;</span>

<span class="n">basin</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">get_basins</span><span class="p">(</span><span class="n">station_id</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">navigate_byid</span></code> class method can be used to navigate NHDPlus in
both upstream and downstream of any point in the database. Let’s get the ComIDs and flowlines
of the tributaries and the main river channel upstream of the station.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flw_main</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">navigate_byid</span><span class="p">(</span>
    <span class="n">fsource</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">fid</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">navigation</span><span class="o">=</span><span class="s2">&quot;upstreamMain&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;flowlines&quot;</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">flw_trib</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">navigate_byid</span><span class="p">(</span>
    <span class="n">fsource</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">fid</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">navigation</span><span class="o">=</span><span class="s2">&quot;upstreamTributaries&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;flowlines&quot;</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can get other USGS stations upstream (or downstream) of the station
and even set a distance limit (in km):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">st_all</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">navigate_byid</span><span class="p">(</span>
    <span class="n">fsource</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">fid</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">navigation</span><span class="o">=</span><span class="s2">&quot;upstreamTributaries&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">st_d20</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">navigate_byid</span><span class="p">(</span>
    <span class="n">fsource</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">fid</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">navigation</span><span class="o">=</span><span class="s2">&quot;upstreamTributaries&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We can get more information about these stations using GeoConnex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gcx</span> <span class="o">=</span> <span class="n">GeoConnex</span><span class="p">(</span><span class="s2">&quot;gages&quot;</span><span class="p">)</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">st_all</span><span class="o">.</span><span class="n">identifier</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">gages</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gcx</span><span class="o">.</span><span class="n">query</span><span class="p">({</span><span class="s2">&quot;provider_id&quot;</span><span class="p">:</span> <span class="n">sid</span><span class="p">})</span> <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">),</span>
    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Instead, we can carry out a spatial query within the basin of interest:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gages</span> <span class="o">=</span> <span class="n">pynhd</span><span class="o">.</span><span class="n">geoconnex</span><span class="p">(</span>
    <span class="n">item</span><span class="o">=</span><span class="s2">&quot;gages&quot;</span><span class="p">,</span>
    <span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">basin</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s get the
<a class="reference external" href="https://www.sciencebase.gov/catalog/item/5762b664e4b07657d19a71ea">HUC12 pour points</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pp</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">navigate_byid</span><span class="p">(</span>
    <span class="n">fsource</span><span class="o">=</span><span class="s2">&quot;nwissite&quot;</span><span class="p">,</span>
    <span class="n">fid</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;USGS-</span><span class="si">{</span><span class="n">station_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">navigation</span><span class="o">=</span><span class="s2">&quot;upstreamTributaries&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;huc12pp&quot;</span><span class="p">,</span>
    <span class="n">distance</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/nhdplus.ipynb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/nhdplus_navigation.png" class="align-center" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/nhdplus_navigation.png" /></a>
<p>Also, we can get the slope data for each river segment from the NHDPlus VAA database:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vaa</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">nhdplus_vaa</span><span class="p">(</span><span class="s2">&quot;input_data/nhdplus_vaa.parquet&quot;</span><span class="p">)</span>

<span class="n">flw_trib</span><span class="p">[</span><span class="s2">&quot;comid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">flw_trib</span><span class="o">.</span><span class="n">nhdplus_comid</span><span class="p">)</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flw_trib</span><span class="p">,</span> <span class="n">vaa</span><span class="p">[[</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="s2">&quot;slope&quot;</span><span class="p">]],</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;comid&quot;</span><span class="p">),</span>
    <span class="n">crs</span><span class="o">=</span><span class="n">flw_trib</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">slope</span><span class="p">[</span><span class="n">slope</span><span class="o">.</span><span class="n">slope</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
<p>Additionally, we can obtain cross-section lines along the main river channel with 4 km spacing
and width of 2 km using <code class="docutils literal notranslate"><span class="pre">network_xsection</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pynhd</span> <span class="kn">import</span> <span class="n">NHD</span>

<span class="n">distance</span> <span class="o">=</span> <span class="mi">4000</span>  <span class="c1"># in meters</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># in meters</span>
<span class="n">nhd</span> <span class="o">=</span> <span class="n">NHD</span><span class="p">(</span><span class="s2">&quot;flowline_mr&quot;</span><span class="p">)</span>
<span class="n">main_nhd</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">byids</span><span class="p">(</span><span class="s2">&quot;COMID&quot;</span><span class="p">,</span> <span class="n">flw_main</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">main_nhd</span> <span class="o">=</span> <span class="n">pynhd</span><span class="o">.</span><span class="n">prepare_nhdplus</span><span class="p">(</span><span class="n">main_nhd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">purge_non_dendritic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">main_nhd</span> <span class="o">=</span> <span class="n">main_nhd</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;ESRI:102003&quot;</span><span class="p">)</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">pynhd</span><span class="o">.</span><span class="n">network_xsection</span><span class="p">(</span><span class="n">main_nhd</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, we can use <a class="reference external" href="https://github.com/hyriver/py3dep">Py3DEP</a>
to obtain the elevation profile along the cross-section lines.</p>
<p>Now, let’s explore the PyGeoAPI capabilities. There are two ways that you can access
PyGeoAPI: <code class="docutils literal notranslate"><span class="pre">PyGeoAPI</span></code> class and <code class="docutils literal notranslate"><span class="pre">pygeoapi</span></code> function. The <code class="docutils literal notranslate"><span class="pre">PyGeoAPI</span></code> class
is for querying the database for a single location using tuples and list while the
<code class="docutils literal notranslate"><span class="pre">pygeoapi</span></code> function is for querying the database for multiple locations at once
and accepts a <code class="docutils literal notranslate"><span class="pre">geopandas.GeoDataFrame</span></code> as input. The <code class="docutils literal notranslate"><span class="pre">pygeoapi</span></code> function
is more efficient than the <code class="docutils literal notranslate"><span class="pre">PyGeoAPI</span></code> class and has a simpler interface. In future
versions, the <code class="docutils literal notranslate"><span class="pre">PyGeoAPI</span></code> class will be deprecated and the <code class="docutils literal notranslate"><span class="pre">pygeoapi</span></code> function
will be the only way to access the database. Let’s compare the two, starting by
<code class="docutils literal notranslate"><span class="pre">PyGeoAPI</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pygeoapi</span> <span class="o">=</span> <span class="n">PyGeoAPI</span><span class="p">()</span>

<span class="n">trace</span> <span class="o">=</span> <span class="n">pygeoapi</span><span class="o">.</span><span class="n">flow_trace</span><span class="p">(</span>
    <span class="p">(</span><span class="mf">1774209.63</span><span class="p">,</span> <span class="mf">856381.68</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;ESRI:102003&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
<span class="p">)</span>

<span class="n">split</span> <span class="o">=</span> <span class="n">pygeoapi</span><span class="o">.</span><span class="n">split_catchment</span><span class="p">((</span><span class="o">-</span><span class="mf">73.82705</span><span class="p">,</span> <span class="mf">43.29139</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span> <span class="n">upstream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">profile</span> <span class="o">=</span> <span class="n">pygeoapi</span><span class="o">.</span><span class="n">elevation_profile</span><span class="p">(</span>
    <span class="p">[(</span><span class="o">-</span><span class="mf">103.801086</span><span class="p">,</span> <span class="mf">40.26772</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">103.80097</span><span class="p">,</span> <span class="mf">40.270568</span><span class="p">)],</span>
    <span class="n">numpts</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
    <span class="n">dem_res</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">section</span> <span class="o">=</span> <span class="n">pygeoapi</span><span class="o">.</span><span class="n">cross_section</span><span class="p">(</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">103.80119</span><span class="p">,</span> <span class="mf">40.2684</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">numpts</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;epsg:4326&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s do the same operations using <code class="docutils literal notranslate"><span class="pre">pygeoapi</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sgeom</span>
<span class="kn">import</span> <span class="nn">pynhd</span> <span class="k">as</span> <span class="nn">nhd</span>

<span class="n">coords</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">],</span>
        <span class="s2">&quot;upstream&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">],</span>
        <span class="s2">&quot;numpts&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="n">geometry</span><span class="o">=</span><span class="p">[</span>
        <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">73.82705</span><span class="p">,</span> <span class="mf">43.29139</span><span class="p">),</span>
        <span class="n">sgeom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mf">103.801086</span><span class="p">,</span> <span class="mf">40.26772</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">trace</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">pygeoapi</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="s2">&quot;flow_trace&quot;</span><span class="p">)</span>
<span class="n">split</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">pygeoapi</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="s2">&quot;split_catchment&quot;</span><span class="p">)</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">pygeoapi</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="s2">&quot;cross_section&quot;</span><span class="p">)</span>

<span class="n">coords</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">],</span>
        <span class="s2">&quot;upstream&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">],</span>
        <span class="s2">&quot;numpts&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span>
        <span class="s2">&quot;dem_res&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="n">geometry</span><span class="o">=</span><span class="p">[</span>
        <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">([(</span><span class="o">-</span><span class="mf">103.801086</span><span class="p">,</span> <span class="mf">40.26772</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">103.80097</span><span class="p">,</span> <span class="mf">40.270568</span><span class="p">)]),</span>
        <span class="n">sgeom</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">([(</span><span class="o">-</span><span class="mf">102.801086</span><span class="p">,</span> <span class="mf">39.26772</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">102.80097</span><span class="p">,</span> <span class="mf">39.270568</span><span class="p">)]),</span>
    <span class="p">],</span>
    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">pygeoapi</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="s2">&quot;elevation_profile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/pygeoapi.ipynb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/split_catchment.png" class="align-center" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/split_catchment.png" /></a>
<p>Next, we retrieve mid- and high-resolution flowlines within the bounding box of our
watershed and compare them using <code class="docutils literal notranslate"><span class="pre">WaterData</span></code> for mid-resolution, <code class="docutils literal notranslate"><span class="pre">NHDPlusHR</span></code> for
high-resolution.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mr</span> <span class="o">=</span> <span class="n">WaterData</span><span class="p">(</span><span class="s2">&quot;nhdflowline_network&quot;</span><span class="p">)</span>
<span class="n">nhdp_mr</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">bybox</span><span class="p">(</span><span class="n">basin</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

<span class="n">hr</span> <span class="o">=</span> <span class="n">NHDPlusHR</span><span class="p">(</span><span class="s2">&quot;flowline&quot;</span><span class="p">)</span>
<span class="n">nhdp_hr</span> <span class="o">=</span> <span class="n">hr</span><span class="o">.</span><span class="n">bygeom</span><span class="p">(</span><span class="n">basin</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/nhdplus.ipynb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/hr_mr.png" class="align-center" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/hr_mr.png" /></a>
<p>An alternative to <code class="docutils literal notranslate"><span class="pre">WaterData</span></code> and <code class="docutils literal notranslate"><span class="pre">NHDPlusHR</span></code> is the <code class="docutils literal notranslate"><span class="pre">NHD</span></code> class that
supports both the mid- and high-resolution NHDPlus V2 data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mr</span> <span class="o">=</span> <span class="n">NHD</span><span class="p">(</span><span class="s2">&quot;flowline_mr&quot;</span><span class="p">)</span>
<span class="n">nhdp_mr</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">bygeom</span><span class="p">(</span><span class="n">basin</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

<span class="n">hr</span> <span class="o">=</span> <span class="n">NHD</span><span class="p">(</span><span class="s2">&quot;flowline_hr&quot;</span><span class="p">)</span>
<span class="n">nhdp_hr</span> <span class="o">=</span> <span class="n">hr</span><span class="o">.</span><span class="n">bygeom</span><span class="p">(</span><span class="n">basin</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
<p>Moreover, <code class="docutils literal notranslate"><span class="pre">WaterData</span></code> can find features within a given radius (in meters) of a point:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">eck4</span> <span class="o">=</span> <span class="s2">&quot;+proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs&quot;</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">5727797.427596455</span><span class="p">,</span> <span class="mf">5584066.49330473</span><span class="p">)</span>
<span class="n">rad</span> <span class="o">=</span> <span class="mf">5e3</span>
<span class="n">flw_rad</span> <span class="o">=</span> <span class="n">mr</span><span class="o">.</span><span class="n">bydistance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">loc_crs</span><span class="o">=</span><span class="n">eck4</span><span class="p">)</span>
<span class="n">flw_rad</span> <span class="o">=</span> <span class="n">flw_rad</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">eck4</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead of getting all features within a radius of the coordinate, we can snap to the closest
feature ID using NLDI:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comid_closest</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">comid_byloc</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">eck4</span><span class="p">)</span>
<span class="n">flw_closest</span> <span class="o">=</span> <span class="n">nhdp_mr</span><span class="o">.</span><span class="n">byid</span><span class="p">(</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="n">comid_closest</span><span class="o">.</span><span class="n">comid</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/nhdplus.ipynb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/nhdplus_radius.png" class="align-center" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/nhdplus_radius.png" /></a>
<p>Since NHDPlus HR is still at the pre-release stage let’s use the MR flowlines to
demonstrate the vector-based accumulation. Based on a topological sorted river network
<code class="docutils literal notranslate"><span class="pre">pynhd.vector_accumulation</span></code> computes flow accumulation in the network.
It returns a data frame that is sorted from upstream to downstream that
shows the accumulated flow in each node.</p>
<p>PyNHD has a utility called <code class="docutils literal notranslate"><span class="pre">prepare_nhdplus</span></code> that identifies such
relationships among other things such as fixing some common issues with
NHDPlus flowlines. But first, we need to get all the NHDPlus attributes
for each ComID since <code class="docutils literal notranslate"><span class="pre">NLDI</span></code> only provides the flowlines’ geometries
and ComIDs which is useful for navigating the vector river network data.
For getting the NHDPlus database we use <code class="docutils literal notranslate"><span class="pre">WaterData</span></code>. Let’s use the
<code class="docutils literal notranslate"><span class="pre">nhdflowline_network</span></code> layer to get required info.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wd</span> <span class="o">=</span> <span class="n">WaterData</span><span class="p">(</span><span class="s2">&quot;nhdflowline_network&quot;</span><span class="p">)</span>

<span class="n">comids</span> <span class="o">=</span> <span class="n">flw_trib</span><span class="o">.</span><span class="n">nhdplus_comid</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">nhdp_trib</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">byid</span><span class="p">(</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="n">comids</span><span class="p">)</span>
<span class="n">flw</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">prepare_nhdplus</span><span class="p">(</span><span class="n">nhdp_trib</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">purge_non_dendritic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>To demonstrate the use of routing, let’s use <code class="docutils literal notranslate"><span class="pre">nhdplus_attrs</span></code> function to get a list of available
NHDPlus attributes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="o">=</span> <span class="s2">&quot;CAT_RECHG&quot;</span>
<span class="n">area</span> <span class="o">=</span> <span class="s2">&quot;areasqkm&quot;</span>

<span class="n">local</span> <span class="o">=</span> <span class="n">nldi</span><span class="o">.</span><span class="n">getcharacteristic_byid</span><span class="p">(</span><span class="n">comids</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="n">char_ids</span><span class="o">=</span><span class="n">char</span><span class="p">)</span>
<span class="n">flw</span> <span class="o">=</span> <span class="n">flw</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">local</span><span class="p">[</span><span class="n">char</span><span class="p">],</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">runoff_acc</span><span class="p">(</span><span class="n">qin</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">qin</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">a</span>


<span class="n">flw_r</span> <span class="o">=</span> <span class="n">flw</span><span class="p">[[</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="s2">&quot;tocomid&quot;</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="n">area</span><span class="p">]]</span>
<span class="n">runoff</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">vector_accumulation</span><span class="p">(</span><span class="n">flw_r</span><span class="p">,</span> <span class="n">runoff_acc</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="p">[</span><span class="n">char</span><span class="p">,</span> <span class="n">area</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">area_acc</span><span class="p">(</span><span class="n">ain</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ain</span> <span class="o">+</span> <span class="n">a</span>


<span class="n">flw_a</span> <span class="o">=</span> <span class="n">flw</span><span class="p">[[</span><span class="s2">&quot;comid&quot;</span><span class="p">,</span> <span class="s2">&quot;tocomid&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">]]</span>
<span class="n">areasqkm</span> <span class="o">=</span> <span class="n">nhd</span><span class="o">.</span><span class="n">vector_accumulation</span><span class="p">(</span><span class="n">flw_a</span><span class="p">,</span> <span class="n">area_acc</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="p">[</span><span class="n">area</span><span class="p">])</span>

<span class="n">runoff</span> <span class="o">/=</span> <span class="n">areasqkm</span>
</pre></div>
</div>
<p>Since these are catchment-scale characteristics, let’s get the catchments
then add the accumulated characteristic as a new column and plot the
results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wd</span> <span class="o">=</span> <span class="n">WaterData</span><span class="p">(</span><span class="s2">&quot;catchmentsp&quot;</span><span class="p">)</span>
<span class="n">catchments</span> <span class="o">=</span> <span class="n">wd</span><span class="o">.</span><span class="n">byid</span><span class="p">(</span><span class="s2">&quot;featureid&quot;</span><span class="p">,</span> <span class="n">comids</span><span class="p">)</span>

<span class="n">c_local</span> <span class="o">=</span> <span class="n">catchments</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;featureid&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">c_acc</span> <span class="o">=</span> <span class="n">catchments</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">runoff</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;featureid&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="https://github.com/hyriver/HyRiver-examples/blob/main/notebooks/nhdplus.ipynb"><img alt="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/flow_accumulation.png" class="align-center" src="https://raw.githubusercontent.com/hyriver/HyRiver-examples/main/notebooks/_static/flow_accumulation.png" /></a>
<p>More examples can be found <a class="reference external" href="https://pygeohydro.readthedocs.io/en/latest/examples.html">here</a>.</p>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../readmes.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Software Stack</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pygeohydro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PyGeoHydro: Retrieve Geospatial Hydrology Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Taher Chegini<br/>
  
      &copy; Copyright 2019-2022, Taher Chegini.<br/>
    Last updated on 2022-07-26.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>